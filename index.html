<!doctype html>

<html lang="ro">

<head>
	<meta name="generator" content="Hugo 0.40.1" />
    <meta charset="utf-8">
    <title>Vot Diaspora</title>
    <meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0" />
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    
    <p>


<section class='code4 code4-section 
                 code4-section-small  
                 code4-section-light '>
    <div class='code4 code4-content '><p>o aplicație <a href="https://github.com/code4romania/vot-diaspora">dezvoltată</a> de <img src='code4-black.svg' style='vertical-align: middle; margin-top: -3px;' class='code4-text-height'/></p>
</div>
</section>




<section class='code4 code4-section 
                 code4-section-normal  
                 code4-section-dark '>
    <div class='code4 code4-content '><figure class="code4-center-text">
    
        <img src="logo.png" alt="Vot Diaspora Logo" />
    
    
</figure>

<h1 id="vot-diaspora">Vot Diaspora</h1>

<p>Pe 26 mai 2019 au loc alegerile europarlamentare. Românii de pretutindeni au dreptul de a-și alege reprezentanții în Parlamentul European.</p>

<p>Dacă locuiești peste hotare, ai două opțiuni: fie te înscrii pe listele electorale ale statului de rezidență și alegi dintre candidații statului respectiv, fie votezi candidații României. Pentru cea de-a doua opțiune, ai nevoie de un pașaport valid (chiar și cel temporar), carte de identitate (chiar și provizorie) sau buletin.<sup>1</sup></p>

<p>Folosește harta de mai jos pentru a vedea care este cea mai apropiată secție de votare din orașul sau țara în care locuiești.</p>

<p>Surse:</p>

<ol>
<li>Situl oficial MAE, secțiunea privind exercitarea dreptului de vot <a href="https://www.mae.ro/node/48110">https://www.mae.ro/node/48110</a></li>
</ol>
</div>
</section>




<section class='code4 code4-section 
                 code4-section-normal  
                 code4-section-light '>
    <div class='code4 code4-content '>
        <h1 id="unde-pot-vota-button-class-code4-code4-button-code4-button-locate-id-the-locate-button-localizează-mă-button">Unde pot vota? <button class='code4 code4-button code4-button-locate' id='the-locate-button'>Localizează-mă</button></h1>

<p>Caută orașul în care locuiești pentru a afla care sunt cele mai apropiate secții de votare.</p>

        <div id='theLocations'>
        </div>
    </div>
    <div id='theMapContainer'>
        <div id='theMap' class='votd-map'></div>
    </div>
</section>




<section class='code4 code4-section 
                 code4-section-normal  
                 code4-section-dark '>
    <div class='code4 code4-content '><h1 id="înființarea-unei-secții">Înființarea unei secții</h1>

<p>Cea mai apropiată secție de vot e totuși prea departe de orașul sau satul unde locuiești?</p>

<p>Poți cere înființarea unei secții de votare mai aproape de tine. Poți completa <a href='https://facem.declic.ro/campaigns/trimite-email-aep-mae'>acest formular</a> cu datele tale și trimite către AEP și MAE.</p>

<p>După ce vei trimite cererea, un e-mail de confirmare te va ghida pentru trimiterea acesteia și către Ambasada României din țara unde locuiești.</p>
</div>
</section>




<section class='code4 code4-section 
                 code4-section-small  
                 code4-section-dark '>
    <div class='code4 code4-content  code4-content-special '><h1 id="informează-ți-prietenii">Informează-ți prietenii</h1>

<p>Pe 26 mai 2019 au loc alegerile europarlamentare. Românii de pretutindeni au dreptul de a-și alege reprezentanții în Parlamentul European. Distribuie aceste informații în social media pentru a ajuta cât mai mulți români să afle unde pot vota.
<center>
<button class='code4 code4-button code4-button-square' id='the-square-button'><span class='icon-facebook'></span></button>
<button class='code4 code4-button code4-button-square' id='the-square-button'><span class='icon-twitter'></span></button>
<button class='code4 code4-button code4-button-square' id='the-square-button'><span class='icon-linkedin'></span></button>
</center></p>

<h1 id="susține-ne">Susține-ne</h1>

<p><em>Vot Diaspora</em> este un proiect dezvoltat pro-bono de o echipă de voluntari <a href="https://code4.ro/ro/">Code for Romania</a>. În fiecare zi, sute dintre prietenii si colegii tăi lucrează pentru a construi intrumente digitale utile pentru a ne face viața mai ușoară și pentru a aduce România mai aproape de progresul tehnologic. Ajută-ne să mergem mai departe.</p>

<p><center><a id='theDonateButton' href='https://code4.ro/ro/doneaza/'>Donează</a></center></p>
</div>
</section>




<section class='code4 code4-section 
                 code4-section-normal  
                 code4-section-dark '>
    <div class='code4 code4-content  code4-content-footer '><p><center>© 2019 <a href="https://code4.ro/">Code for Romania</a><br/>Organizație neguvernamentală independentă, neafiliată politic și apolitică.</center></p>

<figure class="code4-center-text">
    
        <img src="code4-symbol-yellow.png" alt="Code for Romania Logo" height="32" />
    
    
</figure>
</div>
</section>
</p>


    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js" integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg==" crossorigin=""></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
    <script>

        

        function toRadians(degrees) {
            return degrees * Math.PI / 180;
        }

        

        function getEarthDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; 

            const φ1 = toRadians(lat1);
            const φ2 = toRadians(lat2);

            const Δφ = toRadians(lat2 - lat1);
            const Δλ = toRadians(lon2 - lon1);

            
            const h = Math.pow(Math.sin(Δφ / 2), 2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.pow(Math.sin(Δλ/2), 2);

            
            const d = 2 * R * Math.atan2(Math.sqrt(h), Math.sqrt(1 - h));

            return d
        }

        
        
        for (const p of document.getElementsByTagName('p')){
            if (p.innerHTML.replace(/\s/g, '').length === 0){
                p.style.display = 'none';
            }
        }

        const initialZoomLevel = 3;
        var map = L.map('theMap').setView(
            [48.355045, 16.230324],
            initialZoomLevel);

        
        
        const mapAttribution =
            '<a href="https://www.openstreetmap.org/copyright">' +
                'OpenStreetMap'                                  +
            '</a>'                                               +
            ' | '                                                +
            '<a href="https://www.mae.ro/sites/default/files/file/anul_2019/2019_pdf/2019.04.25_lista_sectiilor_de_votare_din_strainatate_la_alegerile_pentru_parlamentul_european_din_2019.pdf">' +
                'Sursa datelor MAE'                              +
            '</a>';

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: mapAttribution,
            fullScreenControl: true,
            zoomControl: false
        }).addTo(map);

        
        var markerIcon = L.icon({
            iconUrl: 'marker.png',
            iconSize: [20, 39],
            iconAnchor: [10, 39]
        });

        let locations = [];

        
        fetch('data2.json')
            .then(res => res.json())
            .then((out) => {
                locations = out.places;
                for (const location of locations) {
                    let coordinates = location.Coordinates;
                    coordinates[0] = parseFloat(coordinates[0]);
                    coordinates[1] = parseFloat(coordinates[1]);
                    let street = location['Street'];
                    if (location['StNo'] && location['StNo'].length > 0) {
                        street = location['StNo'] + ' ' + street;
                    }
                    let messageHtml =
                        '<h1 style="margin:0">Secția de votare nr. ' + location.Number + '</h1><hr>' +
                        '<h2 style="margin:0">' + location.Name + '</h2>' +
                        '<p style="margin:0"><a href="' + getNativeURL(location.Number) + '">' + street + '</a></p>';

                    if (location.Phone) {
                        messageHtml += '<p style="margin:0">Telefon <a href="tel:' + location.Phone + '">' + location.Phone + '</a></p>';
                    }
                    if (location.Website) {
                        messageHtml += '<p style="margin:0"><a href="' + location.Website + '">' + location.Website + '</a></p>'
                    }
                    const marker = L.marker(coordinates, {
                        'title': location.Name,
                        'icon': GetIconForZoomLevel(initialZoomLevel)
                    }).bindPopup(messageHtml, {
                        offset: [0, 0]
                    });
                    location.Marker = marker;
                    marker.addTo(map);
                }
            }).catch(err => console.error(err));

        let theLocateButton = document.getElementById('the-locate-button');
        theLocateButton.addEventListener('mouseup', function(e) {

            
            navigator.geolocation.getCurrentPosition(function(position) {

                
                

                let myLat = 51.505;
                let myLon = -0.09;

                
                locations = locations.sort(function(l1, l2) {
                    let lat1 = l1.Coordinates[0];
                    let lon1 = l1.Coordinates[1];
                    let lat2 = l2.Coordinates[0];
                    let lon2 = l2.Coordinates[1];
                    let d1 = getEarthDistance(myLat, myLon, lat1, lon1);
                    let d2 = getEarthDistance(myLat, myLon, lat2, lon2);
                    return d1 - d2;
                });

                const theLocations = document.getElementById('theLocations');
                let ht = '<ol>';
                let closestMarkers = [];
                for (let i = 0; i < 6; ++i) {
                    closestMarkers.push(locations[i].Marker);
                    ht += '<li onclick="goToLocation(' + i + ')"><h1>' + locations[i].Name + '</h1>';
                }
                ht += '</ol>';
                theLocations.innerHTML = ht;

                var group = new L.featureGroup(closestMarkers);
                map.fitBounds(group.getBounds(), {
                    'duration': 0
                });
            });
        });

        function goToLocation(index) {
            map.setView(locations[index].Coordinates, 10);
            locations[index].Marker.openPopup();
        }

        function getNativeURL(id) {
            let location = null;
            for (l of locations) {
                if (l.Number == id) {
                    location = l;
                    break;
                }
            }
            if (!location) return;
            if ((navigator.platform.indexOf("iPhone") != -1) ||
                (navigator.platform.indexOf("iPad")   != -1) ||
                (navigator.platform.indexOf("iPod")   != -1) ||
                (navigator.platform.indexOf("Mac")    != -1)) {
                if (location.AppleURL) {
                    return location.AppleURL;
                }
            }
            return location.GoogleURL;
        }

        let theMap = document.getElementById('theMap');

        let i = 0;

        function GetIconForZoomLevel(zoomLevel) {
            console.log(zoomLevel);
            if (zoomLevel > 7) {
                return markerIcon;
            } else {
                return L.divIcon({
                    className: 'code4-map-circle-icon',
                    iconSize: L.point(2 * zoomLevel, 2 * zoomLevel)
                });
            }
        }

        function UpdateMarkers() {
            map.eachLayer(function (layer) {
                if (layer instanceof L.Marker) {
                    return layer.setIcon(GetIconForZoomLevel(map.getZoom()));
                }
            });
        }
        UpdateMarkers(); 
        map.on('zoomend', UpdateMarkers);
     </script>

</body>

</html>
